<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Amazon Product Scraper</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
  <style>
    .loader {
      border-top-color: #3498db;
      animation: spinner 1.5s linear infinite;
    }
    @keyframes spinner {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .image-gallery img {
      max-height: 100px;
      object-fit: contain;
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen">
  <div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold text-center mb-8">Amazon Product Scraper</h1>
    
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
      <form id="scrape-form" class="flex flex-col md:flex-row gap-4">
        <input 
          type="url" 
          id="product-url" 
          placeholder="Enter Amazon product URL" 
          class="flex-grow px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
          required
        >
        <button 
          type="submit" 
          class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
        >
          Scrape Product
        </button>
      </form>
    </div>

    <div id="loading" class="hidden flex justify-center my-8">
      <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12"></div>
    </div>

    <div id="error" class="hidden bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-8 rounded">
      <p id="error-message"></p>
    </div>

    <div id="results" class="hidden">
      <!-- Product Header -->
      <div class="bg-white rounded-lg shadow-md p-6 mb-6">
        <div class="flex flex-col md:flex-row gap-6">
          <div class="md:w-1/3">
            <div id="main-image" class="bg-gray-100 rounded-lg p-4 flex items-center justify-center h-64">
              <img src="" alt="Product" class="max-h-full object-contain">
            </div>
            <div id="image-gallery" class="image-gallery flex overflow-x-auto gap-2 mt-4 p-2"></div>
          </div>
          <div class="md:w-2/3">
            <h2 id="product-name" class="text-2xl font-bold mb-2"></h2>
            <div class="flex items-center mb-4">
              <span id="rating" class="text-yellow-500 font-bold mr-2"></span>
              <span id="num-ratings" class="text-gray-600"></span>
            </div>
            <div class="flex items-center mb-4">
              <span id="price" class="text-2xl font-bold text-green-600 mr-4"></span>
              <span id="discount" class="bg-red-100 text-red-600 px-2 py-1 rounded text-sm"></span>
            </div>
            <div id="bank-offers" class="mb-4 p-4 bg-yellow-50 rounded-lg text-sm"></div>
            <div id="ai-summary" class="mb-4 p-4 bg-blue-50 rounded-lg">
              <h3 class="font-bold text-blue-800 mb-2">AI Review Summary</h3>
              <p id="ai-summary-text"></p>
            </div>
          </div>
        </div>
      </div>

      <!-- Product Details -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
        <div class="bg-white rounded-lg shadow-md p-6">
          <h3 class="text-xl font-bold mb-4">About This Item</h3>
          <div id="about-item" class="text-gray-700"></div>
        </div>
        <div class="bg-white rounded-lg shadow-md p-6">
          <h3 class="text-xl font-bold mb-4">Product Information</h3>
          <div id="product-info" class="text-gray-700"></div>
        </div>
      </div>

      <!-- Manufacturer Images -->
      <div class="bg-white rounded-lg shadow-md p-6 mb-6">
        <h3 class="text-xl font-bold mb-4">Manufacturer Images</h3>
        <div id="manufacturer-images" class="flex flex-wrap gap-4"></div>
      </div>

      <!-- Customer Reviews -->
      <div class="bg-white rounded-lg shadow-md p-6">
        <h3 class="text-xl font-bold mb-4">Customer Reviews</h3>
        <div id="customer-reviews"></div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('scrape-form');
      const loading = document.getElementById('loading');
      const results = document.getElementById('results');
      const error = document.getElementById('error');
      const errorMessage = document.getElementById('error-message');

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const url = document.getElementById('product-url').value;
        
        // Reset UI
        results.classList.add('hidden');
        error.classList.add('hidden');
        loading.classList.remove('hidden');
        
        try {
          const response = await fetch(`/scrape?url=${encodeURIComponent(url)}`);
          
          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.details || 'Failed to scrape product');
          }
          
          const data = await response.json();
          displayResults(data);
          
          loading.classList.add('hidden');
          results.classList.remove('hidden');
        } catch (err) {
          loading.classList.add('hidden');
          error.classList.remove('hidden');
          errorMessage.textContent = err.message;
        }
      });

      function displayResults(data) {
        // Product name and basics
        document.getElementById('product-name').textContent = data.productName;
        document.getElementById('rating').textContent = data.rating;
        document.getElementById('num-ratings').textContent = data.numRatings;
        document.getElementById('price').textContent = data.sellingPrice;
        document.getElementById('discount').textContent = data.totalDiscount || 'No discount';
        
        // Bank offers
        const bankOffersEl = document.getElementById('bank-offers');
        if (data.bankOffers && data.bankOffers !== 'N/A') {
          bankOffersEl.innerHTML = `<strong>Special Offers:</strong> ${data.bankOffers}`;
        } else {
          bankOffersEl.innerHTML = '<em>No special offers available</em>';
        }
        
        // AI Summary
        document.getElementById('ai-summary-text').textContent = data.aiReviewSummary;
        
        // About this item
        document.getElementById('about-item').innerHTML = formatTextWithBullets(data.aboutThisItem);
        
        // Product information
        document.getElementById('product-info').innerHTML = formatTextWithBullets(data.productInfo);
        
        // Images
        const mainImageEl = document.querySelector('#main-image img');
        const imageGalleryEl = document.getElementById('image-gallery');
        imageGalleryEl.innerHTML = '';
        
        if (data.images && data.images.length > 0) {
          mainImageEl.src = data.images[0];
          data.images.forEach(imgSrc => {
            const img = document.createElement('img');
            img.src = imgSrc;
            img.alt = 'Product image';
            img.className = 'cursor-pointer border hover:border-blue-500';
            img.onclick = () => { mainImageEl.src = imgSrc; };
            imageGalleryEl.appendChild(img);
          });
        } else {
          mainImageEl.src = '/api/placeholder/300/300';
          mainImageEl.alt = 'No image available';
        }
        
        // Manufacturer images
        const manufacturerImagesEl = document.getElementById('manufacturer-images');
        manufacturerImagesEl.innerHTML = '';
        
        if (data.manufacturerImages && data.manufacturerImages.length > 0) {
          data.manufacturerImages.forEach(imgSrc => {
            const img = document.createElement('img');
            img.src = imgSrc;
            img.alt = 'Manufacturer image';
            img.className = 'max-h-40 object-contain';
            manufacturerImagesEl.appendChild(img);
          });
        } else {
          manufacturerImagesEl.innerHTML = '<p class="text-gray-500">No manufacturer images available</p>';
        }
        
        // Customer reviews
        const reviewsEl = document.getElementById('customer-reviews');
        reviewsEl.innerHTML = '';
        
        if (data.customerReviews && data.customerReviews.length > 0) {
          data.customerReviews.forEach(review => {
            const reviewEl = document.createElement('div');
            reviewEl.className = 'mb-4 pb-4 border-b border-gray-200';
            reviewEl.innerHTML = `<p>${review}</p>`;
            reviewsEl.appendChild(reviewEl);
          });
        } else {
          reviewsEl.innerHTML = '<p class="text-gray-500">No customer reviews available</p>';
        }
      }

      function formatTextWithBullets(text) {
        if (!text || text === 'N/A') return '<p class="text-gray-500">Information not available</p>';
        
        // Check if the text already contains bullets or special formatting
        if (text.includes('â€¢') || text.includes('\n')) {
          // Convert newlines to <br> and keep existing formatting
          return text.split('\n').map(line => `<p>${line.trim()}</p>`).join('');
        } else {
          // Just return as a paragraph
          return `<p>${text}</p>`;
        }
      }
    });
  </script>
</body>
</html>